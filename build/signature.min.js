/*! signature 2013-04-20 */
(function(){var n=function(){var n=function(n){return n.replace(/(?:(?:^|\n)\s+|\s+(?:$|\n))/g,"").replace(/\s+/g," ")},a=function(n,t){var a,r=[];for(a in n){var i=n[a];"*"!==a&&r.push(e(a,i,t))}return r},e=function(a,e,r){var i,o,u=a.split(","),d=[],f=!0;for(d.data=[],d.data[0]={linksTo:[],index:-1},d.responder=e,o=1;u.length+1>o;o++){if(i=n(u[o-1]),""===i)return d.hasEmptyPath=!0,d;d.data[o]={},i.length>=3&&"["===i.charAt(0)&&"]"===i.charAt(i.length-1)?(i=i.substring(1,i.length-1),d.data[o].optional=!0):d.data[o].optional=!1,"!"===i.charAt(0)?(i=i.substring(1,i.length),d.data[o].negator=!0):d.data[o].negator=!1,"..."===i.slice(i.length-3,i.length)?(i=i.substring(0,i.length-3),d.data[o].infinite=!0):d.data[o].infinite=!1,d.data[o].index=o-1,d.data[o].matcher=t.findByName(i,r,d.data[o].negator),d.data[o].linksTo=[],d.data[o].isStartingNode=f,d.data[o].infinite&&d.data[o].linksTo.push(d.data[o]),f&&d.data[0].linksTo.push(d.data[o]),f&&d.data[o].optional||(f=!1)}for(o=0;d.data.length-1>o;o++){for(var s=!0,l=o+1;d.data.length>l;l++)if(d.data[o].linksTo.push(d.data[l]),!d.data[l].optional){s=!1;break}d.data[o].isEndNode=s}return d.data[o].isEndNode=!0,d.data[1].isEndNode&&d.data[1].isStartingNode&&d.data[1].optional&&(d.hasEmptyPath=!0),console.log("$$$$$ PARSED EXPRESSION IS NOW A TREE $$$$$"),console.log(d),console.log(d.data[0]),d};return a}(),t=function(){var n=function(n,a,e){var r;return"object"==typeof a&&(r=a[n]),r||(r=t[n]),e?function(n){return!r(n)}:r},t={"true":function(n){return n===!0},"false":function(n){return n===!1},undefined:function(n){return void 0===n},NaN:function(n){return isNaN(n)},truthy:function(n){return n?!0:!1},falsy:function(n){return n?!1:!0},object:function(n){return"object"==typeof n},number:function(n){return"number"==typeof n},string:function(n){return"string"==typeof n},any:function(n){return n!==void 0&&null!==n},"function":function(n){return"function"==typeof n}};return t["*"]=t.any,t.falsey=t.falsy,{findByName:n}}(),a=function(){var n=[].slice,t=function(a,e,r,i){if(-1===r||a.matcher(e[r])){var o,u;if(e.length===r+1)return a.isEndNode?(o=[],o[a.index]=a.infinite?n.call(e,r-i,r+1):e[r],o):!1;for(u=0;a.linksTo.length>u;u++){var d=a.linksTo[u],f=0;if(a===d&&(f=i+1),o=t(d,e,r+1,f))return-1!==r&&(a.infinite?o[a.index]||(o[a.index]=n.call(e,r-i,r+1)):o[a.index]=e[r]),o}return!1}return!1},a=function(n,a){return 0===a.length&&n.hasEmptyPath?[]:t(n.data[0],a,-1)};return a}(),e=this,r=function(t,e){var r=n(t,e),i=function(){var n,e,i,o;for(o=0;r.length>o;o++)if(i=r[o],e=a(i,arguments),e!==!1)return n=i.responder,n.apply(this,e);var u=t["*"];return"function"==typeof u?u.apply(this,arguments):void 0};return i};"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=r),exports.signature=r):e.signature=r})();